#!/usr/bin/env bash

set -eE

function report {
  message=$(cat << EOF
job queue exception

job queue exception
EOF)
  ghi open -m "$message" -- liufengyun/bench}

trap report ERR

# job queue service

while true; do
  files=( jobs/*.job )
  first="${files[0]}"
  source $first

  rc=$?
  if [[ $rc != 0 ]]; then
    mv "$first" "${first%.job}.fail"
  else
    mv "$first" "${first%.job}.done"
  fi

  sleep 10;
done
